!function(t,e,r,p){var i=!/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent),o=function(t,e,r,p){function i(e){this.$elem=t(e.elem),this.$wrapper=t('<div class="ps-crop-wrapper" />'),this.$cropper=t('<div class="ps-crop-box" />'),this.$wnd=t(window),this.change=e.change||t.noop,this.attach(),this.measurements=this.measure(),this.change(this.getSelection())}return i.prototype.attach=function(){this.$elem.wrap(this.$wrapper),this.$cropper.insertAfter(this.$elem),this.$wrapper=this.$elem.parent(),this.hammertime||(this.hammertime=new e(this.$cropper[0]),this.hammertime.on("pan panstart panend",t.proxy(function(t){t.srcEvent.stopPropagation(),t.srcEvent.preventDefault(),"panstart"===t.type?(this.disableDesktopEvents(),this.onTouch(t)):"pan"===t.type?this.onDragOrResize(t):(this.onRelease(t),this.enableDesktopEvents())},this))),this.enableDesktopEvents()},i.prototype.detach=function(){this.$cropper.detach(),this.$elem.parent().is(this.$wrapper)&&this.$elem.unwrap()},i.prototype.measure=function(){var t=this.$elem,e=this.$wrapper[0],r=this.$cropper.position();return{imageWidth:t.width(),imageHeight:t.height(),wrapperTop:e.scrollTop,wrapperLeft:e.scrollLeft,wrapperWidth:this.$wrapper.width(),wrapperHeight:this.$wrapper.height(),cropperTop:r.top+e.scrollTop,cropperLeft:r.left+e.scrollLeft,cropperWidth:this.$cropper.outerWidth(),cropperHeight:this.$cropper.outerHeight()}},i.prototype.getPointerPosition=function(t,e){var r=this.$cropper.offset();return{top:e-r.top+this.$wnd.scrollTop(),left:t-r.left+this.$wnd.scrollLeft()}},i.prototype.getResizeDirection=function(t){var e=p?15:20,r=this.getPointerPosition(t.center.x,t.center.y),i=this.measurements,o="";return r.top<e?o+="n":r.top>i.cropperHeight-e&&(o+="s"),r.left<e?o+="w":r.left>i.cropperWidth-e&&(o+="e"),o},i.prototype.getSelection=function(){return{x:this.measurements.cropperLeft,y:this.measurements.cropperTop,width:this.measurements.cropperWidth,height:this.measurements.cropperHeight}},i.prototype.onTouch=function(t){this.released=!1,this.measurements=this.measure(),this.direction=this.getResizeDirection(t)},i.prototype.onDragOrResize=_.throttle(function(t){this.direction?this.onResize(t):this.onDrag(t)},p?10:100),i.prototype.onDrag=function(t){var e,r=this.measurements,p=t.deltaY,i=t.deltaX;this.released||(i=Math.min(i,r.imageWidth-r.cropperWidth-r.cropperLeft),i=Math.max(i,0-r.cropperLeft),p=Math.min(p,r.imageHeight-r.cropperHeight-r.cropperTop),e="translate3d("+i+"px, "+(p=Math.max(p,0-r.cropperTop))+"px, 0)",this.$cropper.css({webkitTransform:e,mozTransform:e,transform:e}))},i.prototype.onResize=function(t){var e=this.direction,r=this.measurements,p={};this.released||(e.match(/n/)?(p.top="auto",p.bottom=r.wrapperHeight-r.cropperTop-r.cropperHeight,p.height=r.cropperHeight-t.deltaY):e.match(/s/)&&(p.bottom="auto",p.top=r.cropperTop,p.height=r.cropperHeight+t.deltaY),e.match(/e/)?(p.right="auto",p.left=r.cropperLeft,p.width=r.cropperWidth+t.deltaX):e.match(/w/)&&(p.left="auto",p.right=r.wrapperWidth-r.cropperLeft-r.cropperWidth,p.width=r.cropperWidth-t.deltaX),p.width=p.height=Math.max(p.width||0,p.height||0,64),e.match(/n/)?p.height=Math.min(p.height,r.wrapperHeight-p.bottom):e.match(/s/)?p.height=Math.min(p.height,r.imageHeight-p.top):"auto"!==this.$cropper[0].style.top?p.height=Math.min(p.height,r.imageHeight-parseInt(this.$cropper.css("top"))):p.height=Math.min(p.height,r.wrapperHeight-parseInt(this.$cropper.css("bottom"))),e.match(/e/)?p.width=Math.min(p.width,r.imageWidth-p.left):e.match(/w/)?p.width=Math.min(p.width,r.wrapperWidth-p.right):"auto"!==this.$cropper[0].style.left?p.width=Math.min(p.width,r.imageWidth-parseInt(this.$cropper.css("left"))):p.width=Math.min(p.width,r.wrapperWidth-parseInt(this.$cropper.css("right"))),p.width=p.height=Math.min(p.width,p.height),this.$cropper.css(p))},i.prototype.onRelease=function(t){var e=this.$cropper.position(),r=this.measurements,p={top:Math.max(e.top+r.wrapperTop,0),left:Math.max(e.left+r.wrapperLeft,0),right:"",bottom:"",webkitTransform:"",mozTransform:"",transform:""};this.released=!0,this.$cropper.css(p),this.measurements=this.measure(),this.change(this.getSelection())},i.prototype.destroy=function(){this.detach(),this.$elem=null,this.$wrapper=null,this.$cropper=null,this.$wnd=null,this.hammertime=null},i.prototype.enableDesktopEvents=function(){p&&this.$cropper.on("mousemove.ps-crop",t.proxy(this.onMouseMove,this))},i.prototype.disableDesktopEvents=function(){p&&this.$cropper.off("mousemove.ps-crop")},i.prototype.onMouseMove=function(e){var r=t(e.target).parent().offset(),p=e.pageX-r.left,i=e.pageY-r.top,o="",h=this.measure();i<h.cropperTop-h.wrapperTop+15?o+="n":i>h.cropperTop-h.wrapperTop+h.cropperHeight-15&&(o+="s"),p<h.cropperLeft-h.wrapperLeft+15?o+="w":p>h.cropperLeft-h.wrapperLeft+h.cropperWidth-15&&(o+="e"),this.$cropper.css({cursor:o?o+"-resize":""})},i}(t,e,0,i);ps_crop={},ps_crop.init=function(e){var r,p;(p=(r=t(e.elem)).data("ps-crop"))&&p.destroy(),p=new o(e),r.data("ps-crop",p)},ps_crop.detach=function(e){var r;(r=(e=t(e)).data("ps-crop"))&&r.detach()}}(jQuery||$,Hammer,peepso);